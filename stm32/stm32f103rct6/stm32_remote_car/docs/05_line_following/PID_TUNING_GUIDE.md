# PIDå‚æ•°è°ƒè¯•å®Œå…¨æŒ‡å—

## ğŸ¯ è°ƒè¯•å‰å‡†å¤‡

### 1. ç¡®è®¤ç¡¬ä»¶æ­£å¸¸
- [ ] ä¼ æ„Ÿå™¨å·²æ ¡å‡†ï¼ˆé•¿æŒ‰PD2æŒ‰é’®3ç§’ï¼‰
- [ ] ç”µæœºå·¥ä½œæ­£å¸¸
- [ ] å°è½¦æ”¾åœ¨é»‘åº•ç™½çº¿ä¸Š
- [ ] å¯ç”¨è°ƒè¯•è¾“å‡ºï¼š`line_follower.enableDebug(true)`

### 2. ç†è§£è°ƒè¯•è¾“å‡º

```
Pos:150 Err:150 PID:9 | S:1387 1124 784 375 481 658 962 1587
 â†“      â†“      â†“        â†“
ä½ç½®    è¯¯å·®   PIDè¾“å‡º   8ä¸ªä¼ æ„Ÿå™¨åŸå§‹æ•°æ®
```

#### ä½ç½®å€¼ï¼ˆPosï¼‰å«ä¹‰
- **-1000 åˆ° -500**ï¼šçº¿åœ¨å·¦ä¾§å¾ˆå¤šï¼Œéœ€è¦å¤§å¹…å·¦è½¬
- **-500 åˆ° -200**ï¼šçº¿åå·¦ï¼Œéœ€è¦å·¦è½¬
- **-200 åˆ° +200**ï¼šçº¿æ¥è¿‘ä¸­å¿ƒï¼Œç›´è¡Œæˆ–å¾®è°ƒ
- **+200 åˆ° +500**ï¼šçº¿åå³ï¼Œéœ€è¦å³è½¬
- **+500 åˆ° +1000**ï¼šçº¿åœ¨å³ä¾§å¾ˆå¤šï¼Œéœ€è¦å¤§å¹…å³è½¬

#### PIDè¾“å‡ºå«ä¹‰
- **è´Ÿå€¼ï¼ˆ-100 åˆ° 0ï¼‰**ï¼šå‘å³è½¬ï¼ˆå³è½®å‡é€Ÿï¼‰
- **0**ï¼šç›´è¡Œ
- **æ­£å€¼ï¼ˆ0 åˆ° +100ï¼‰**ï¼šå‘å·¦è½¬ï¼ˆå·¦è½®å‡é€Ÿï¼‰

---

## ğŸ“Š å‚æ•°è°ƒè¯•æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šåªè°ƒPå‚æ•°ï¼ˆKpï¼‰

**ç›®æ ‡**ï¼šè®©å°è½¦èƒ½å¤Ÿè·Ÿéšé»‘çº¿ï¼Œå…è®¸æœ‰éœ‡è¡

```cpp
// è®¾ç½®åˆå§‹å‚æ•°
line_follower.setPID(0.03f, 0.0f, 0.0f);  // åªæœ‰Pï¼Œä»å°å€¼å¼€å§‹
line_follower.setSpeed(20);  // ä½é€Ÿæµ‹è¯•
```

#### è°ƒè¯•è¿‡ç¨‹

1. **è§‚å¯Ÿç°è±¡**ï¼š
   ```
   Pos:200 â†’ PID:6   (Kp Ã— 200 = 0.03 Ã— 200 = 6)
   ```

2. **å¦‚æœå°è½¦ä¸åŠ¨æˆ–ååº”å¾ˆæ…¢**ï¼š
   ```cpp
   // å¢å¤§Kp
   line_follower.setPID(0.05f, 0.0f, 0.0f);
   line_follower.setPID(0.08f, 0.0f, 0.0f);
   line_follower.setPID(0.10f, 0.0f, 0.0f);
   ```

3. **å¦‚æœå°è½¦å·¦å³å‰§çƒˆéœ‡è¡**ï¼š
   ```cpp
   // å‡å°Kp
   line_follower.setPID(0.04f, 0.0f, 0.0f);
   line_follower.setPID(0.02f, 0.0f, 0.0f);
   ```

4. **æ‰¾åˆ°åˆé€‚çš„Kpå€¼**ï¼š
   - å°è½¦èƒ½è·Ÿçº¿
   - æœ‰è½»å¾®éœ‡è¡ï¼ˆè¿™å¾ˆæ­£å¸¸ï¼‰
   - **è®°å½•è¿™ä¸ªå€¼**ï¼Œä¾‹å¦‚ï¼š`Kp = 0.06`

---

### ç¬¬äºŒæ­¥ï¼šè°ƒDå‚æ•°ï¼ˆKdï¼‰

**ç›®æ ‡**ï¼šæ¶ˆé™¤éœ‡è¡ï¼Œè®©è¿è¡Œå¹³æ»‘

```cpp
// ä½¿ç”¨ç¬¬ä¸€æ­¥å¾—åˆ°çš„Kpå€¼ï¼ŒåŠ å…¥Kd
line_follower.setPID(0.06f, 0.0f, 0.5f);  // Kdä»å°å€¼å¼€å§‹
```

#### è°ƒè¯•è¿‡ç¨‹

1. **è§‚å¯Ÿéœ‡è¡æƒ…å†µ**ï¼š
   - å¦‚æœè¿˜éœ‡è¡ï¼šå¢å¤§Kd
   - å¦‚æœååº”å˜æ…¢ï¼šå‡å°Kd

2. **é€æ­¥å¢å¤§Kd**ï¼š
   ```cpp
   line_follower.setPID(0.06f, 0.0f, 1.0f);
   line_follower.setPID(0.06f, 0.0f, 1.5f);
   line_follower.setPID(0.06f, 0.0f, 2.0f);
   ```

3. **æ‰¾åˆ°æœ€ä½³Kd**ï¼š
   - éœ‡è¡æ¶ˆå¤±æˆ–å¤§å¹…å‡å°
   - è¿è¡Œå¹³ç¨³
   - **Kdé€šå¸¸æ˜¯Kpçš„10-20å€**

---

### ç¬¬ä¸‰æ­¥ï¼šè°ƒIå‚æ•°ï¼ˆKiï¼‰ï¼ˆå¯é€‰ï¼‰

**ä»€ä¹ˆæ—¶å€™éœ€è¦Kiï¼Ÿ**
- å°è½¦æŒç»­åå‘ä¸€ä¾§ï¼ˆç¨³æ€è¯¯å·®ï¼‰
- ç›´çº¿æ—¶ä¸åœ¨ä¸­å¿ƒ

**å¤§å¤šæ•°æƒ…å†µKi=0å°±å¤Ÿäº†ï¼**

å¦‚æœéœ€è¦ï¼š
```cpp
// Kiä»æå°å€¼å¼€å§‹
line_follower.setPID(0.06f, 0.0001f, 1.5f);
```

**æ³¨æ„**ï¼šKiè¿‡å¤§ä¼šå¯¼è‡´éœ‡è¡ï¼

---

## ğŸ”§ æ ¹æ®ä½ çš„æ•°æ®è°ƒè¯•

### åˆ†æä½ çš„ä¼ æ„Ÿå™¨æ•°æ®

```
ç¬¬1è¡Œ: S:1387 1124 784 375 481 658 962 1587
       åˆ†æ: æœ€å°å€¼375(ä¼ æ„Ÿå™¨3)ï¼Œæœ€å¤§å€¼1587(ä¼ æ„Ÿå™¨7)
       å¯¹æ¯”åº¦: 1587-375 = 1212 (å¾ˆå¥½ï¼)
       å³°å€¼ä½ç½®: ä¼ æ„Ÿå™¨3 (åè½¬åæœ€å¤§)
       
ç¬¬2è¡Œ: S:1551 1345 965 375 364 469 657 1502
       æœ€å°å€¼364(ä¼ æ„Ÿå™¨4)ï¼Œå¯¹æ¯”åº¦1187
       å³°å€¼ä½ç½®: ä¼ æ„Ÿå™¨3-4ä¹‹é—´
       
ç¬¬3è¡Œ: S:1647 1403 702 297 278 351 466 1513
       æœ€å°å€¼278(ä¼ æ„Ÿå™¨4)ï¼Œå¯¹æ¯”åº¦1369
       å³°å€¼ä½ç½®: ä¼ æ„Ÿå™¨4åå·¦
```

### é—®é¢˜è¯Šæ–­

ä»ä½ çš„æ•°æ®çœ‹ï¼Œçº¿åœ¨**ä¸­é—´åå³**ï¼Œä½†å°è½¦å¯èƒ½ï¼š
1. æ²¡æœ‰æ­£ç¡®è½¬å‘
2. PIDå‚æ•°å¤ªå°ï¼Œè¾“å‡ºä¸å¤Ÿ

### å»ºè®®çš„è°ƒè¯•å‚æ•°

#### æ–¹æ¡ˆ1ï¼šå¢å¤§Kpï¼ˆæ¨èå…ˆè¯•è¿™ä¸ªï¼‰
```cpp
// åœ¨main.cppç¬¬125è¡Œä¿®æ”¹
line_follower.setPID(0.10f, 0.0f, 1.5f);  // å¢å¤§Kpåˆ°0.10
line_follower.setSpeed(20);  // é™ä½åˆ°20%é€Ÿåº¦
```

#### æ–¹æ¡ˆ2ï¼šæ£€æŸ¥ç”µæœºæ–¹å‘
ä½ çš„DriveTrainåˆå§‹åŒ–æ˜¯ï¼š
```cpp
DriveTrain drive_train(motor1, motor3, motor2, motor4);
```

ç¡®ä¿ï¼š
- `motor1`å’Œ`motor2`æ˜¯å·¦ä¾§ç”µæœº
- `motor3`å’Œ`motor4`æ˜¯å³ä¾§ç”µæœº

**å¦‚æœè½¬å‘åäº†**ï¼Œäº¤æ¢motorå‚æ•°ï¼š
```cpp
DriveTrain drive_train(motor2, motor4, motor1, motor3);  // å°è¯•äº¤æ¢
```

#### æ–¹æ¡ˆ3ï¼šæ£€æŸ¥PIDè¾“å‡ºç¬¦å·
åœ¨`line_follower.cpp`ç¬¬97è¡Œï¼š
```cpp
drive_.setTargetSpeed(base_speed_, -(int16_t)pid_output_);
```

å¦‚æœè½¬å‘åäº†ï¼Œå»æ‰è´Ÿå·ï¼š
```cpp
drive_.setTargetSpeed(base_speed_, (int16_t)pid_output_);
```

---

## ğŸ“ˆ å®Œæ•´è°ƒè¯•æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ç¡®è®¤ç¡¬ä»¶å’Œä¼ æ„Ÿå™¨æ­£å¸¸              â”‚
â”‚     âœ“ ä¼ æ„Ÿå™¨æ ¡å‡†å®Œæˆ                 â”‚
â”‚     âœ“ ç”µæœºèƒ½æ­£å¸¸è½¬åŠ¨                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. è®¾ç½®ä½é€Ÿå’Œå°Kp                   â”‚
â”‚     setPID(0.03, 0, 0)              â”‚
â”‚     setSpeed(20)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. è§‚å¯Ÿå°è½¦è¡Œä¸º                     â”‚
â”‚     ä¸åŠ¨/æ…¢ â†’ å¢å¤§Kp                â”‚
â”‚     éœ‡è¡å‰§çƒˆ â†’ å‡å°Kp               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. æ‰¾åˆ°åˆé€‚Kpï¼ˆèƒ½è·Ÿçº¿ï¼Œè½»å¾®éœ‡è¡ï¼‰   â”‚
â”‚     è®°å½•ï¼šKp = 0.06ï¼ˆç¤ºä¾‹ï¼‰          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. åŠ å…¥Kdæ¶ˆé™¤éœ‡è¡                   â”‚
â”‚     setPID(0.06, 0, 1.0)            â”‚
â”‚     é€æ­¥å¢å¤§Kdç›´åˆ°å¹³ç¨³               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. ï¼ˆå¯é€‰ï¼‰åŠ å…¥Kiæ¶ˆé™¤ç¨³æ€è¯¯å·®       â”‚
â”‚     setPID(0.06, 0.0001, 1.5)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7. é€æ­¥æé€Ÿæµ‹è¯•                     â”‚
â”‚     setSpeed(30) â†’ 40 â†’ 50          â”‚
â”‚     å¯èƒ½éœ€è¦å¾®è°ƒKpå’ŒKd               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ å¸¸è§é—®é¢˜é€ŸæŸ¥è¡¨

| ç°è±¡ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ³• |
|------|---------|---------|
| **å°è½¦ä¸åŠ¨** | Kpå¤ªå° | å¢å¤§Kpåˆ°0.08-0.12 |
| **å·¦å³å‰§çƒˆéœ‡è¡** | Kpå¤ªå¤§ | å‡å°Kpåˆ°0.03-0.05 |
| **èƒ½è·Ÿçº¿ä½†æŠ–åŠ¨** | Kdä¸è¶³ | å¢å¤§Kdåˆ°1.0-2.0 |
| **è½¬å‘åäº†** | ç”µæœºæ¥çº¿æˆ–PIDç¬¦å·é”™è¯¯ | æ£€æŸ¥DriveTrainåˆå§‹åŒ–æˆ–æ”¹PIDç¬¦å· |
| **æŒç»­åä¸€ä¾§** | æœ‰ç¨³æ€è¯¯å·® | åŠ å…¥å°é‡Ki (0.0001) |
| **Poså’ŒErrä¸æ˜¾ç¤º** | æµ®ç‚¹æ ¼å¼åŒ–é—®é¢˜ | å·²ä¿®å¤ï¼Œç”¨æ•´æ•°è¾“å‡º |
| **é¢‘ç¹ä¸¢çº¿** | é˜ˆå€¼å¤ªé«˜ | å·²ä¿®å¤ï¼Œç”¨å¯¹æ¯”åº¦æ£€æµ‹ |
| **ç›´é“æ­£å¸¸å¼¯é“å†²å‡º** | Kdä¸å¤Ÿæˆ–é€Ÿåº¦å¤ªå¿« | å¢å¤§Kdæˆ–é™é€Ÿ |

---

## ğŸ”¬ è¿›é˜¶æŠ€å·§

### 1. æ ¹æ®ä½ç½®åŠ¨æ€è°ƒé€Ÿ

```cpp
// åœ¨ä¸»å¾ªç¯ä¸­æ·»åŠ 
float pos = line_follower.getPosition();
if (abs(pos) > 500) {
    // æ€¥å¼¯ï¼Œå‡é€Ÿ
    line_follower.setSpeed(20);
} else if (abs(pos) < 200) {
    // ç›´é“ï¼ŒåŠ é€Ÿ
    line_follower.setSpeed(40);
} else {
    // ç¼“å¼¯ï¼Œä¸­é€Ÿ
    line_follower.setSpeed(30);
}
```

### 2. æ ¹æ®é€Ÿåº¦è°ƒæ•´PID

```cpp
void updatePIDBySpeed(int speed) {
    if (speed <= 25) {
        line_follower.setPID(0.06f, 0.0f, 1.0f);  // ä½é€Ÿ
    } else if (speed <= 40) {
        line_follower.setPID(0.08f, 0.0f, 1.5f);  // ä¸­é€Ÿ
    } else {
        line_follower.setPID(0.12f, 0.0f, 2.0f);  // é«˜é€Ÿ
    }
}
```

### 3. è¾“å‡ºæ•°æ®åˆ†æ

è§‚å¯Ÿè°ƒè¯•è¾“å‡ºï¼Œå¯»æ‰¾è§„å¾‹ï¼š
```
Pos:300 Err:300 PID:18 | S:1500 1200 800 350 340 500 900 1600
       â†“
ä½ç½®åå³300ï¼ŒPIDè¾“å‡º18ï¼ˆå‘å³è½¬ï¼‰
å¦‚æœå°è½¦æ²¡ååº” â†’ Kpå¤ªå°
å¦‚æœè½¬è¿‡å¤´ â†’ Kpå¤ªå¤§
```

---

## ğŸ“ è°ƒè¯•è®°å½•æ¨¡æ¿

å»ºè®®è®°å½•æ¯æ¬¡è°ƒè¯•çš„å‚æ•°å’Œæ•ˆæœï¼š

```
æµ‹è¯•1:
  å‚æ•°: Kp=0.03, Ki=0, Kd=0, Speed=20
  ç°è±¡: å°è½¦ä¸åŠ¨/ååº”æ…¢
  ç»“è®º: Kpå¤ªå°

æµ‹è¯•2:
  å‚æ•°: Kp=0.08, Ki=0, Kd=0, Speed=20
  ç°è±¡: èƒ½è·Ÿçº¿ä½†éœ‡è¡ä¸¥é‡
  ç»“è®º: éœ€è¦åŠ Kd

æµ‹è¯•3:
  å‚æ•°: Kp=0.08, Ki=0, Kd=1.5, Speed=20
  ç°è±¡: å¹³ç¨³è·Ÿçº¿
  ç»“è®º: âœ… åŸºç¡€å‚æ•°ç¡®å®š

æµ‹è¯•4:
  å‚æ•°: Kp=0.08, Ki=0, Kd=1.5, Speed=35
  ç°è±¡: å¯ä»¥è·Ÿçº¿ï¼Œé€Ÿåº¦OK
  ç»“è®º: âœ… æœ€ç»ˆå‚æ•°
```

---

## ğŸš€ ç«‹å³å¼€å§‹è°ƒè¯•

### ç¬¬ä¸€æ¬¡è°ƒè¯•å»ºè®®é…ç½®

```cpp
// åœ¨main.cppç¬¬125-126è¡Œä¿®æ”¹ä¸ºï¼š
line_follower.setPID(0.08f, 0.0f, 1.2f);  // æ¨èèµ·å§‹å€¼
line_follower.setSpeed(20);               // ä½é€Ÿå¼€å§‹
line_follower.enableDebug(true);          // å¿…é¡»å¯ç”¨
```

### è§‚å¯Ÿè¿™äº›å…³é”®ä¿¡æ¯

1. **Poså€¼**ï¼šæ˜¯å¦éšç€å°è½¦ç§»åŠ¨è€Œå˜åŒ–ï¼Ÿ
2. **PIDå€¼**ï¼šæ˜¯å¦æœ‰åˆç†çš„è¾“å‡ºï¼Ÿ
3. **å°è½¦è¡Œä¸º**ï¼šæ˜¯å¦æŒ‰ç…§PIDè¾“å‡ºè½¬å‘ï¼Ÿ

å¦‚æœå°è½¦å®Œå…¨ä¸è½¬å‘ï¼Œå¯èƒ½æ˜¯ï¼š
- ç”µæœºæ¥çº¿é—®é¢˜
- DriveTrainé…ç½®é—®é¢˜
- PIDç¬¦å·é—®é¢˜

**ç¥è°ƒè¯•é¡ºåˆ©ï¼** ğŸ‰
