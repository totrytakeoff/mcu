# å·¡çº¿æ§åˆ¶å‚æ•°å®Œå…¨æŒ‡å—

## ğŸš¨ é—®é¢˜è¯Šæ–­ï¼šé€Ÿåº¦å¤ªå¿«ã€æ§åˆ¶å¤ªæ¿€è¿›

### æ ¹æœ¬åŸå› åˆ†æ

ä½ é‡åˆ°çš„é—®é¢˜æºäº**å¤šå±‚æ§åˆ¶å‚æ•°å åŠ **ï¼š

```
ä½ç½®èŒƒå›´(-1000~+1000) 
    â†“ Ã— Kp(0.06)
PIDè¾“å‡º(-60~+60) 
    â†“ Ã— ç¼©æ”¾ç³»æ•°(é»˜è®¤1.0ï¼Œå¤ªå¤§ï¼)
è½¬å‘é€Ÿåº¦(-60~+60)
    â†“ Ã— è½¬å‘çµæ•åº¦(0.8)
å®é™…è½¬å‘å¼ºåº¦(-48~+48)  â† å¤ªæ¿€è¿›äº†ï¼
```

---

## âœ… å·²æ·»åŠ çš„æ§åˆ¶å‚æ•°

### æ–°å¢æ¥å£ï¼šPIDè¾“å‡ºç¼©æ”¾

```cpp
// è®¾ç½®PIDè¾“å‡ºç¼©æ”¾ç³»æ•°ï¼ˆæ§åˆ¶è½¬å‘å¼ºåº¦ï¼‰
line_follower.setPIDOutputScale(0.1f);  // èŒƒå›´ï¼š0.01-1.0
```

**ä½œç”¨**ï¼šç›´æ¥æ§åˆ¶è½¬å‘å¼ºåº¦ï¼Œæ˜¯æœ€å…³é”®çš„å‚æ•°ï¼

---

## ğŸ¯ å®Œæ•´å‚æ•°ä½“ç³»

### ç¬¬ä¸€å±‚ï¼šåŸºç¡€é€Ÿåº¦å‚æ•°

#### 1. åŸºç¡€é€Ÿåº¦ï¼ˆbase_speedï¼‰
```cpp
line_follower.setSpeed(10);  // èŒƒå›´ï¼š0-100
```

**å»ºè®®å€¼**ï¼š
- åˆæ¬¡è°ƒè¯•ï¼š**5-10**ï¼ˆææ…¢ï¼Œä¾¿äºè§‚å¯Ÿï¼‰
- ç¨³å®šåï¼š**15-25**
- æ­£å¸¸è¿è¡Œï¼š**30-40**
- ç«é€Ÿï¼š**50-70**

---

### ç¬¬äºŒå±‚ï¼šPIDå‚æ•°

#### 2. æ¯”ä¾‹ç³»æ•°ï¼ˆKpï¼‰
```cpp
line_follower.setPID(0.06f, 0.0f, 1.0f);
                     â†‘Kp
```

**ä½œç”¨**ï¼šæ§åˆ¶å¯¹åå·®çš„å“åº”å¼ºåº¦

**å»ºè®®å€¼**ï¼š
- æ¸©å’Œï¼š**0.03-0.05**
- æ¨èï¼š**0.06-0.08**
- æ¿€è¿›ï¼š**0.10-0.15**

**è®¡ç®—ç¤ºä¾‹**ï¼š
```
ä½ç½®åå·®ï¼š300
Kp = 0.06
åŸå§‹PIDè¾“å‡º = 300 Ã— 0.06 = 18
```

#### 3. å¾®åˆ†ç³»æ•°ï¼ˆKdï¼‰
```cpp
line_follower.setPID(0.06f, 0.0f, 1.5f);
                               â†‘Kd
```

**ä½œç”¨**ï¼šæŠ‘åˆ¶éœ‡è¡ï¼Œé¢„æµ‹è¶‹åŠ¿

**å»ºè®®å€¼**ï¼š
- ä½é€Ÿï¼š**1.0-1.5**
- ä¸­é€Ÿï¼š**1.5-2.0**
- é«˜é€Ÿï¼š**2.0-3.0**

**é€šå¸¸Kd = Kp Ã— 15~25**

#### 4. ç§¯åˆ†ç³»æ•°ï¼ˆKiï¼‰
```cpp
line_follower.setPID(0.06f, 0.0001f, 1.5f);
                          â†‘Kiï¼ˆé€šå¸¸ä¸º0ï¼‰
```

**ä½œç”¨**ï¼šæ¶ˆé™¤ç¨³æ€è¯¯å·®

**å¤§å¤šæ•°æƒ…å†µKi=0å°±å¤Ÿäº†ï¼**

---

### ç¬¬ä¸‰å±‚ï¼šPIDè¾“å‡ºç¼©æ”¾ï¼ˆğŸŒŸæœ€å…³é”®ï¼‰

#### 5. PIDè¾“å‡ºç¼©æ”¾ç³»æ•°
```cpp
line_follower.setPIDOutputScale(0.1f);  // èŒƒå›´ï¼š0.01-1.0
```

**è¿™æ˜¯æ§åˆ¶è½¬å‘å¼ºåº¦çš„æ ¸å¿ƒå‚æ•°ï¼**

**å»ºè®®å€¼**ï¼š
| ç¼©æ”¾ç³»æ•° | è½¬å‘å¼ºåº¦ | é€‚ç”¨åœºæ™¯ |
|---------|---------|---------|
| **0.05** | ææ¸©å’Œ | åˆæ¬¡è°ƒè¯•ï¼Œè§‚å¯Ÿè¡Œä¸º |
| **0.08** | æ¸©å’Œ | ç¨³å®šå·¡çº¿ |
| **0.10** | é€‚ä¸­ | æ¨èå€¼ï¼ˆé»˜è®¤ï¼‰ |
| **0.15** | ä¸­ç­‰ | ç›´é“è¾ƒå¤š |
| **0.20** | æ¿€è¿› | å¿«é€Ÿååº” |
| **0.30** | éå¸¸æ¿€è¿› | ç«é€Ÿï¼ˆæ…ç”¨ï¼‰ |

**æ•ˆæœå¯¹æ¯”**ï¼š
```
å‡è®¾ï¼š
- ä½ç½®åå·®ï¼š500
- Kp = 0.06
- åŸå§‹PID = 500 Ã— 0.06 = 30

ç¼©æ”¾ç³»æ•° = 0.05:  æœ€ç»ˆè½¬å‘ = 30 Ã— 0.05 = 1.5  â† éå¸¸æ¸©å’Œ
ç¼©æ”¾ç³»æ•° = 0.10:  æœ€ç»ˆè½¬å‘ = 30 Ã— 0.10 = 3.0  â† æ¨è
ç¼©æ”¾ç³»æ•° = 0.20:  æœ€ç»ˆè½¬å‘ = 30 Ã— 0.20 = 6.0  â† æ¿€è¿›
ç¼©æ”¾ç³»æ•° = 1.00:  æœ€ç»ˆè½¬å‘ = 30 Ã— 1.00 = 30.0 â† å¤ªæ¿€è¿›ï¼
```

---

### ç¬¬å››å±‚ï¼šDriveTrainå‚æ•°

#### 6. åŠ é€Ÿåº¦å‚æ•°
```cpp
// åœ¨main.cppç¬¬115è¡Œ
drive_train.setAcceleration(3, 5, 8);  // åŠ é€Ÿåº¦ã€å‡é€Ÿåº¦ã€åå‘å‡é€Ÿåº¦
```

**å»ºè®®å€¼**ï¼š
```cpp
// æ¸©å’Œå¯åŠ¨ï¼ˆæ¨èï¼‰
drive_train.setAcceleration(3, 5, 8);

// æ ‡å‡†ï¼ˆåŸé…ç½®ï¼‰
drive_train.setAcceleration(5, 8, 12);

// æ¿€è¿›
drive_train.setAcceleration(8, 12, 15);
```

#### 7. æ›´æ–°é—´éš”
```cpp
drive_train.setUpdateInterval(20);  // 20ms = 50Hz
```

**å›ºå®šä¸º20mså³å¯ï¼Œä¸å»ºè®®ä¿®æ”¹**

---

## ğŸ”§ å‚æ•°è°ƒæ•´å®Œæ•´æµç¨‹

### é˜¶æ®µ1ï¼šåˆå§‹åŒ–è®¾ç½®ï¼ˆææ¸©å’Œï¼‰

```cpp
// åœ¨main.cppç¬¬115-127è¡Œä¿®æ”¹ä¸ºï¼š
drive_train.setAcceleration(3, 5, 8);          // æ¸©å’ŒåŠ é€Ÿ
line_follower.setPID(0.06f, 0.0f, 1.0f);       // æ ‡å‡†PID
line_follower.setSpeed(10);                    // æä½é€Ÿ
line_follower.setPIDOutputScale(0.05f);        // ææ¸©å’Œè½¬å‘
line_follower.enableDebug(true);               // å¿…é¡»å¯ç”¨
```

**ç›®æ ‡**ï¼šå°è½¦èƒ½æ…¢é€Ÿè·Ÿçº¿ï¼Œè§‚å¯Ÿè¡Œä¸º

---

### é˜¶æ®µ2ï¼šè§‚å¯Ÿè°ƒè¯•è¾“å‡º

æ–°çš„è°ƒè¯•è¾“å‡ºæ ¼å¼ï¼š
```
Pos:300 Err:300 RawPID:18 PID:1 Spd:10 | S:1387 1124 784 375 481 658 962 1587
 â†“       â†“       â†“        â†“    â†“
ä½ç½®    è¯¯å·®    åŸå§‹PID  ç¼©æ”¾å åŸºç¡€é€Ÿåº¦
```

**å…³é”®æ•°æ®è§£è¯»**ï¼š
- `Pos`ï¼šçº¿çš„ä½ç½®ï¼ˆ-1000åˆ°+1000ï¼‰
- `RawPID`ï¼šPIDåŸå§‹è¾“å‡º
- `PID`ï¼šç¼©æ”¾åçš„è½¬å‘é€Ÿåº¦ï¼ˆè¿™ä¸ªæ‰æ˜¯å®é™…æ§åˆ¶é‡ï¼‰
- `Spd`ï¼šåŸºç¡€é€Ÿåº¦

---

### é˜¶æ®µ3ï¼šè°ƒæ•´ç¼©æ”¾ç³»æ•°

æ ¹æ®å°è½¦è¡Œä¸ºè°ƒæ•´`setPIDOutputScale()`ï¼š

#### æƒ…å†µAï¼šå°è½¦å‡ ä¹ä¸è½¬å‘
```cpp
// å¢å¤§ç¼©æ”¾ç³»æ•°
line_follower.setPIDOutputScale(0.10f);  // ä»0.05å¢åŠ åˆ°0.10
line_follower.setPIDOutputScale(0.15f);  // å†å¢åŠ åˆ°0.15
```

#### æƒ…å†µBï¼šå°è½¦è½¬å‘å‰§çƒˆã€éœ‡è¡
```cpp
// å‡å°ç¼©æ”¾ç³»æ•°
line_follower.setPIDOutputScale(0.03f);  // å‡å°åˆ°0.03
```

#### æƒ…å†µCï¼šè½¬å‘åˆé€‚ï¼Œä½†ååº”æ…¢
```cpp
// ä¿æŒç¼©æ”¾ç³»æ•°ï¼Œå¢å¤§Kd
line_follower.setPID(0.06f, 0.0f, 2.0f);
```

---

### é˜¶æ®µ4ï¼šé€æ­¥æé€Ÿ

å½“è½¬å‘æ§åˆ¶ç¨³å®šåï¼Œé€æ­¥æé«˜é€Ÿåº¦ï¼š

```cpp
line_follower.setSpeed(15);  // ç¬¬ä¸€æ­¥
// æµ‹è¯•ç¨³å®šå...

line_follower.setSpeed(20);  // ç¬¬äºŒæ­¥
// æµ‹è¯•ç¨³å®šå...

line_follower.setSpeed(25);  // ç¬¬ä¸‰æ­¥
```

**æ³¨æ„**ï¼šæé€Ÿæ—¶å¯èƒ½éœ€è¦åŒæ­¥è°ƒæ•´ï¼š
- å¢å¤§Kdï¼ˆæŠ‘åˆ¶é«˜é€Ÿéœ‡è¡ï¼‰
- ç¨å¾®å¢å¤§ç¼©æ”¾ç³»æ•°ï¼ˆè¡¥å¿æƒ¯æ€§ï¼‰

---

## ğŸ“Š å‚æ•°é€ŸæŸ¥è¡¨

### æ¨èé…ç½®ç»„åˆ

#### é…ç½®1ï¼šåˆæ¬¡è°ƒè¯•ï¼ˆææ¸©å’Œï¼‰
```cpp
drive_train.setAcceleration(3, 5, 8);
line_follower.setPID(0.06f, 0.0f, 1.0f);
line_follower.setSpeed(10);
line_follower.setPIDOutputScale(0.05f);  // â† å…³é”®
```

#### é…ç½®2ï¼šç¨³å®šå·¡çº¿ï¼ˆæ¨èï¼‰
```cpp
drive_train.setAcceleration(5, 8, 12);
line_follower.setPID(0.08f, 0.0f, 1.5f);
line_follower.setSpeed(25);
line_follower.setPIDOutputScale(0.10f);  // â† å…³é”®
```

#### é…ç½®3ï¼šä¸­é€Ÿè¿è¡Œ
```cpp
drive_train.setAcceleration(5, 8, 12);
line_follower.setPID(0.10f, 0.0f, 2.0f);
line_follower.setSpeed(35);
line_follower.setPIDOutputScale(0.12f);  // â† å…³é”®
```

#### é…ç½®4ï¼šé«˜é€Ÿç«é€Ÿ
```cpp
drive_train.setAcceleration(8, 12, 15);
line_follower.setPID(0.12f, 0.0f, 2.5f);
line_follower.setSpeed(50);
line_follower.setPIDOutputScale(0.15f);  // â† å…³é”®
```

---

## ğŸ¯ é—®é¢˜è¯Šæ–­å†³ç­–æ ‘

```
é—®é¢˜ï¼šé€Ÿåº¦å¤ªå¿«ï¼Ÿ
â”œâ”€â†’ YES â†’ é™ä½ setSpeed(10)
â””â”€â†’ NO  â†’ ç»§ç»­

é—®é¢˜ï¼šè½¬å‘å¤ªæ¿€è¿›ã€éœ‡è¡ï¼Ÿ
â”œâ”€â†’ YES â†’ é™ä½ setPIDOutputScale(0.05)
â””â”€â†’ NO  â†’ ç»§ç»­

é—®é¢˜ï¼šè½¬å‘åˆé€‚ä½†æŠ–åŠ¨ï¼Ÿ
â”œâ”€â†’ YES â†’ å¢å¤§ Kd (åˆ°2.0-3.0)
â””â”€â†’ NO  â†’ ç»§ç»­

é—®é¢˜ï¼šè½¬å‘ä¸å¤Ÿï¼Ÿ
â”œâ”€â†’ YES â†’ å¢å¤§ setPIDOutputScale(0.15)
â””â”€â†’ NO  â†’ ç»§ç»­

é—®é¢˜ï¼šååº”å¤ªæ…¢ï¼Ÿ
â”œâ”€â†’ YES â†’ å¢å¤§ Kp (åˆ°0.10-0.12)
â””â”€â†’ NO  â†’ å‚æ•°åˆé€‚ï¼
```

---

## ğŸ”¬ é«˜çº§æŠ€å·§

### 1. åŠ¨æ€è°ƒæ•´ç¼©æ”¾ç³»æ•°

æ ¹æ®ä½ç½®åå·®åŠ¨æ€è°ƒæ•´ï¼š

```cpp
// åœ¨ä¸»å¾ªç¯ä¸­
float pos = line_follower.getPosition();
if (abs(pos) > 600) {
    // å¤§åå·®ï¼Œéœ€è¦æ€¥è½¬
    line_follower.setPIDOutputScale(0.15f);
} else if (abs(pos) < 200) {
    // å°åå·®ï¼Œæ¸©å’Œæ§åˆ¶
    line_follower.setPIDOutputScale(0.08f);
} else {
    // ä¸­ç­‰åå·®
    line_follower.setPIDOutputScale(0.10f);
}
```

### 2. é€Ÿåº¦è‡ªé€‚åº”å‚æ•°

```cpp
int speed = 25;  // å½“å‰é€Ÿåº¦
line_follower.setSpeed(speed);

if (speed <= 20) {
    line_follower.setPID(0.06f, 0.0f, 1.0f);
    line_follower.setPIDOutputScale(0.08f);
} else if (speed <= 35) {
    line_follower.setPID(0.08f, 0.0f, 1.5f);
    line_follower.setPIDOutputScale(0.10f);
} else {
    line_follower.setPID(0.10f, 0.0f, 2.0f);
    line_follower.setPIDOutputScale(0.12f);
}
```

---

## ğŸ“ è°ƒè¯•è®°å½•è¡¨

| æ—¶é—´ | base_speed | Kp | Kd | scale | ç°è±¡ | ç»“è®º |
|------|-----------|----|----|-------|------|------|
| T1 | 10 | 0.06 | 1.0 | 0.05 | å¤ªæ…¢ï¼Œä¸è½¬å‘ | å¢å¤§scale |
| T2 | 10 | 0.06 | 1.0 | 0.10 | èƒ½è½¬å‘ï¼Œå¹³ç¨³ | âœ… scaleç¡®å®š |
| T3 | 15 | 0.06 | 1.0 | 0.10 | æœ‰éœ‡è¡ | å¢å¤§Kd |
| T4 | 15 | 0.06 | 1.5 | 0.10 | å¹³ç¨³ | âœ… æé€Ÿ |
| T5 | 25 | 0.06 | 1.5 | 0.10 | ç¨³å®šå·¡çº¿ | âœ… æœ€ç»ˆé…ç½® |

---

## âš ï¸ é‡è¦æç¤º

### å‚æ•°è°ƒæ•´ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰

1. **setPIDOutputScale()** â† æœ€å…³é”®ï¼æ§åˆ¶è½¬å‘å¼ºåº¦
2. **setSpeed()** â† æ§åˆ¶æ•´ä½“é€Ÿåº¦
3. **Kd** â† æ§åˆ¶éœ‡è¡
4. **Kp** â† æ§åˆ¶å“åº”é€Ÿåº¦
5. **setAcceleration()** â† æ§åˆ¶å¯åœå¹³æ»‘åº¦
6. **Ki** â† é€šå¸¸ä¿æŒ0

### è°ƒè¯•é»„é‡‘æ³•åˆ™

1. **ä»æ¸©å’Œå¼€å§‹**ï¼šå®å¯å¤ªæ…¢ï¼Œä¸è¦å¤ªå¿«
2. **ä¸€æ¬¡åªè°ƒä¸€ä¸ªå‚æ•°**ï¼šä¾¿äºå®šä½é—®é¢˜
3. **è®°å½•æ¯æ¬¡è°ƒæ•´**ï¼šå½¢æˆè°ƒè¯•æ—¥å¿—
4. **å°æ­¥å¿«è·‘**ï¼šæ¯æ¬¡åªå¾®è°ƒ10-20%
5. **éªŒè¯ç¨³å®šæ€§**ï¼šæ¯ä¸ªé…ç½®è‡³å°‘è·‘10åœˆ

---

## ğŸš€ ç«‹å³è¡ŒåŠ¨

### ç¬¬ä¸€æ­¥ï¼šä½¿ç”¨ææ¸©å’Œé…ç½®

åœ¨ `src/main.cpp` ç¬¬115-127è¡Œä¿®æ”¹ä¸ºï¼š

```cpp
drive_train.setAcceleration(3, 5, 8);
line_follower.setPID(0.06f, 0.0f, 1.0f);
line_follower.setSpeed(8);                    // æä½é€Ÿ
line_follower.setPIDOutputScale(0.05f);       // ææ¸©å’Œè½¬å‘
line_follower.enableDebug(true);
```

### ç¬¬äºŒæ­¥ï¼šè§‚å¯Ÿè¡Œä¸º

ç¼–è¯‘ä¸Šä¼ åè§‚å¯Ÿï¼š
- å°è½¦æ˜¯å¦èƒ½æ…¢é€Ÿè·Ÿçº¿ï¼Ÿ
- RawPIDå’ŒPIDçš„æ•°å€¼ï¼Ÿ
- è½¬å‘æ˜¯å¦è¶³å¤Ÿï¼Ÿ

### ç¬¬ä¸‰æ­¥ï¼šé€æ­¥è°ƒæ•´

æ ¹æ®è§‚å¯Ÿç»“æœè°ƒæ•´ `setPIDOutputScale()`ï¼š
- è½¬å‘ä¸å¤Ÿ â†’ å¢å¤§åˆ°0.08, 0.10, 0.12...
- è½¬å‘å¤ªæ¿€è¿› â†’ å‡å°åˆ°0.03, 0.02...

**ç°åœ¨å°±å»è¯•è¯•å§ï¼** ğŸ‰
