C51 COMPILER V9.59.0.0   EX3                                                               08/09/2023 22:05:19 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE EX3
OBJECT MODULE PLACED IN ex3.OBJ
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ex3.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include<reg51.h>  //包含51单片机寄存器定义的头文件
   2          #include "intrins.h"
   3          #define uint unsigned int 
   4          #define uchar unsigned char 
   5          
   6          #define true  1 
   7          #define false 0 
   8          //配置无线模式端口定义  
   9          sbit  WX_M0=P1^1;
  10          sbit  WX_M1=P1^2; 
  11          
  12          //方向键
  13          sbit Left    = P0^0;
  14          sbit Right   = P0^1;
  15          sbit Forward = P0^2;
  16          sbit Back    = P0^3;
  17          //加减速键
  18          sbit UpSpeed   = P0^4;
  19          sbit DownSpeed = P0^5;
  20          //功能键
  21          sbit F1 = P0^6;
  22          sbit F2 = P0^7;
  23          sbit F3 = P1^3;
  24          sbit F4 = P1^4;
  25          //拨码开关
  26          sbit S1 = P2^0;
  27          sbit S2 = P2^1;
  28          sbit S3 = P2^2;
  29          sbit S4 = P2^3;
  30          sbit S5 = P2^4;
  31          sbit S6 = P2^5;
  32          sbit S7 = P2^6;
  33          sbit S8 = P2^7;
  34          //串口初始化
  35          void init_9600(void)
  36          {
  37   1          TMOD = 0x20;      
  38   1          TH1 = 0xFD;   
  39   1          TL1 = 0xFD;
  40   1          SCON = 0x50;      
  41   1          PCON &= 0xef;   
  42   1          TR1 = 1;        
  43   1        
  44   1          IE = 0x0;   
  45   1      
  46   1      }
  47          //发送一个字节
  48          void send_char(unsigned char txd)
  49          {
  50   1          SBUF = txd;
  51   1          while(!TI);     
  52   1          TI = 0;         
  53   1      }
  54          void send_one_byte_to_char(unsigned char ch)
  55          {
C51 COMPILER V9.59.0.0   EX3                                                               08/09/2023 22:05:19 PAGE 2   

  56   1        if ((ch & 0xf0) > 0x90)
  57   1        {
  58   2          send_char(((ch>>4)&0x0f) + 'A'-0x0a);
  59   2        }
  60   1        else
  61   1        {
  62   2          send_char(((ch>>4)&0x0f) + '0'-0x00);
  63   2        }
  64   1        if ((ch & 0x0f) > 0x09)
  65   1        {
  66   2          send_char((ch&0x0f) + 'A'-0x0a);
  67   2        }
  68   1        else
  69   1        {
  70   2          send_char((ch&0x0f) + '0'-0x00);
  71   2        }
  72   1      }
  73          void send_two_byte_to_char(unsigned int ch)
  74          {
  75   1        //3
  76   1        if ((ch & 0xf000) > 0x9000)
  77   1        {
  78   2          send_char(((ch>>12)&0x000f) + 'A'-0x0a);
  79   2        }
  80   1        else
  81   1        {
  82   2          send_char(((ch>>12)&0x000f) + '0'-0x00);
  83   2        }
  84   1        //2
  85   1        if ((ch & 0x0f00) > 0x0900)
  86   1        {
  87   2          send_char(((ch>>8)&0x000f) + 'A'-0x0a);
  88   2        }
  89   1        else
  90   1        {
  91   2          send_char(((ch>>8)&0x000f) + '0'-0x00);
  92   2        }
  93   1        //1
  94   1        if ((ch & 0x00f0) > 0x0090)
  95   1        {
  96   2          send_char(((ch>>4)&0x000f) + 'A'-0x0a);
  97   2        }
  98   1        else
  99   1        {
 100   2          send_char(((ch>>4)&0x000f) + '0'-0x00);
 101   2        }
 102   1        //0
 103   1        if ((ch & 0x000f) > 0x0009)
 104   1        {
 105   2          send_char((ch&0x000f) + 'A'-0x0a);
 106   2        }
 107   1        else
 108   1        {
 109   2          send_char((ch&0x000f) + '0'-0x00);
 110   2        }
 111   1      }
 112          void send_four_byte_to_char(uchar a,uchar b,uchar c,uchar d)
 113          {
 114   1          send_char(a+'0'-0x00);
 115   1          send_char(b+'0'-0x00);
 116   1          send_char(c+'0'-0x00);
 117   1          send_char(d+'0'-0x00);
C51 COMPILER V9.59.0.0   EX3                                                               08/09/2023 22:05:19 PAGE 3   

 118   1      }
 119          void send_string(char *p)
 120          {
 121   1        char *pchar;
 122   1      
 123   1        pchar = p;
 124   1        while (*pchar != '\0')
 125   1        {
 126   2          send_char(*pchar++);    
 127   2        }
 128   1      }
 129          //定时器0初始化
 130          void T0_INIT(void)
 131          {
 132   1          TMOD &= 0xF0; /* Timer 0 mode 1 with software gate */ 
 133   1          TMOD |= 0x01; /* GATE0=0; C/T0#=0; M10=0; M00=1; */ 
 134   1          TH0 = 0x00; /* init values */ 
 135   1          TL0 = 0x00; 
 136   1          ET0=1; /* enable timer0 interrupt */ 
 137   1          //EA=1; /* enable interrupts */ 
 138   1          //TR0=1; /* timer0 run */
 139   1      }
 140          //外部中断1初始化
 141          void INT1_INIT(void)
 142          {
 143   1        
 144   1        IT1=1;//负跳变中断产生
 145   1        EX1=1;//启动外部1中断
 146   1        //EA=1;
 147   1      }
 148           void delay_nus(unsigned int i)  
 149          { 
 150   1        i=i/10;
 151   1        while(--i);
 152   1      }   
 153          
 154          void delay_nms(unsigned int n)  
 155          { 
 156   1        n=n+1;
 157   1        while(--n)  
 158   1        delay_nus(900);         
 159   1      }   
 160          //延时函数1毫秒
 161          void delay1ms()
 162          {
 163   1         unsigned char i,j; 
 164   1         for(i=0;i<10;i++)
 165   1          for(j=0;j<33;j++)
 166   1           ;     
 167   1       }
 168          
 169          //延时函数，n毫秒
 170           void delaynms(unsigned int n)
 171           {
 172   1          unsigned int i;
 173   1          for(i=0;i<n;i++)
 174   1          delay1ms();
 175   1       }
 176          
 177          //主函数
 178          void main(void)
 179          {
C51 COMPILER V9.59.0.0   EX3                                                               08/09/2023 22:05:19 PAGE 4   

 180   1          init_9600();
 181   1          WX_M0=0;//传输模式
 182   1          WX_M1=0;
 183   1          while(1)
 184   1          { 
 185   2              //      
 186   2              if(Left==0)
 187   2              {
 188   3                  //send_string("Left");
 189   3                  send_char('L');
 190   3              }
 191   2              if(Right==0)
 192   2              {
 193   3                  //send_string("Right");
 194   3                  send_char('R');
 195   3              }
 196   2              if(Forward==0)
 197   2              {
 198   3                  //send_string("Forward");
 199   3                  send_char('F');
 200   3              }
 201   2              if(Back==0)
 202   2              {
 203   3                  //send_string("Back");
 204   3                  send_char('B');
 205   3              }
 206   2              if(UpSpeed==0)
 207   2              {
 208   3                  //send_string("UpSpeed");
 209   3                  send_char('U');
 210   3              }
 211   2              if(DownSpeed==0)
 212   2              {
 213   3                  //send_string("DownSpeed");
 214   3                  send_char('D');
 215   3              }
 216   2              if(F1==0)
 217   2              {
 218   3                  //send_string("F1");
 219   3                  send_char('W');
 220   3              }
 221   2              if(F2==0)
 222   2              {
 223   3                  //send_string("F2");
 224   3                  send_char('X');
 225   3              }
 226   2              if(F3==0)
 227   2              {
 228   3                  //send_string("F3");
 229   3                  send_char('Y');
 230   3              }
 231   2              if(F4==0)
 232   2              {
 233   3                  //send_string("F4");
 234   3                  send_char('Z');
 235   3              }
 236   2              delaynms(200);
 237   2          }
 238   1          
 239   1          
 240   1      }
 241          
C51 COMPILER V9.59.0.0   EX3                                                               08/09/2023 22:05:19 PAGE 5   

 242          //外部中断1中断服务函数
 243          void it_INT1(void) interrupt 2 
 244          { 
 245   1        IE1 = 0; 
 246   1      
 247   1      }
 248          //定时器0中断服务函数
 249          void it_timer0(void) interrupt 1 
 250          { 
 251   1        TF0 = 0; 
 252   1      
 253   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    493    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       7
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
