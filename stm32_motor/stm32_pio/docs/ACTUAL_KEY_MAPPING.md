# 实际遥控器按键映射

## 🔍 测试结果分析

根据你的测试，遥控器实际发送的字符如下：

### 实际映射表

| 你按的键 | LED 显示 | 二进制 | 十进制 | 实际接收字符 | ASCII 码 |
|---------|---------|--------|--------|-------------|---------|
| **B** | 1101 | 1101 | 13 | **'M'** 或 **'\r'** | 77 或 13 |
| **W** | 1000 | 1000 | 8 | **'X'** | 88 |
| **F** | 0010 | 0010 | 2 | **'B'** 或 **'R'** | 66 或 82 |
| **L** | 0010 | 0010 | 2 | **'B'** 或 **'R'** | 66 或 82 |
| **R** | 0010 | 0010 | 2 | **'B'** 或 **'R'** | 66 或 82 |
| **U** | 0010 | 0010 | 2 | **'B'** 或 **'R'** | 66 或 82 |
| **Z** | 0010 | 0010 | 2 | **'B'** 或 **'R'** | 66 或 82 |
| **Y** | 1100 | 1100 | 12 | **'L'** | 76 |
| **X** | ？ | ？ | ？ | **？** | ？ |
| **D** | ？ | ？ | ？ | **？** | ？ |

---

## 💡 推测的实际映射

根据 ASCII 码低 4 位分析：

| 实际接收字符 | ASCII | 低4位 | 可能的按键 |
|-------------|-------|-------|-----------|
| **'B'** | 66 | 2 (0010) | Forward (前进) |
| **'X'** | 88 | 8 (1000) | F1 按键 |
| **'L'** | 76 | 12 (1100) | Left (左转) |
| **'M'** 或 **'\r'** | 77/13 | 13 (1101) | Back (后退) |
| **'R'** | 82 | 2 (0010) | Right (右转) |

---

## 🤔 问题分析

### 问题 1：多个按键显示相同
F/L/R/U/Z 都显示 0010 (2)，说明它们都发送了相同的字符 ('B' 或 'R')

**可能原因**：
1. 遥控器按键接触不良，多个按键连在一起
2. 遥控器被重新编程，多个按键映射到同一字符
3. 你按的不是你以为的那个按键

### 问题 2：W 正常，但发送的是 'X'
- 代码中 F1 发送 'W'，但你按 F1 接收到 'X'
- **说明遥控器代码和实际固件不一致**

---

## 🔧 解决方案

### 方案 A：重新测试所有按键

请**逐个按键**测试，并记录：

1. 物理按键位置（上/下/左/右/功能键等）
2. LED 显示的二进制
3. 小车的动作

测试表格：

| 物理按键位置 | LED 显示 (4位) | 小车动作 | 备注 |
|-------------|---------------|---------|------|
| 上方向键 | ____ | ____ | |
| 下方向键 | ____ | ____ | |
| 左方向键 | ____ | ____ | |
| 右方向键 | ____ | ____ | |
| 功能键1 | ____ | ____ | |
| 功能键2 | ____ | ____ | |
| 功能键3 | ____ | ____ | |
| 功能键4 | ____ | ____ | |

---

### 方案 B：根据实际映射修改代码

如果你确认了实际映射，我可以修改代码适配实际字符。

例如，如果确认：
- 前进键发送 'B'
- 后退键发送 'M'
- 左转键发送 'L'
- 右转键发送 'R'
- 功能键1发送 'X'
- 功能键3发送 'Y'

我就修改 `RemoteControl::handleCommand()` 中的映射：

```cpp
case 'B': // 实际的前进键
    ledCode = 1;
    // 前进逻辑
    break;

case 'M': // 实际的后退键
    ledCode = 2;
    // 后退逻辑
    break;

case 'L': // 实际的左转键
    ledCode = 3;
    // 左转逻辑
    break;

case 'R': // 实际的右转键
    ledCode = 4;
    // 右转逻辑
    break;

case 'X': // 实际的功能键1
    ledCode = 7;
    // W功能逻辑
    break;
```

---

### 方案 C：重新烧录遥控器固件

如果遥控器固件和源代码不一致，可以重新烧录遥控器：

1. 使用 Keil 打开 `UAV-F22控制（遥控器端）/ex3.uvproj`
2. 编译生成 HEX 文件
3. 使用 STC-ISP 烧录到遥控器（STC89C52）

---

## 📋 下一步操作

**请选择以下任一方案**：

### 选项 1：完整测试（推荐）
1. 按照测试表格，逐个按键测试
2. 记录所有按键的 LED 显示
3. 告诉我结果，我帮你生成完整映射表

### 选项 2：快速适配
如果你确定：
- 某个按键确实能正常控制前进
- 某个按键确实能正常控制后退
- 某个按键确实能正常控制左转
- 某个按键确实能正常控制右转

那就**告诉我哪个按键对应哪个功能**，我直接修改代码适配。

### 选项 3：使用功能正常的按键
你说 "功能上貌似 fblr u 都是正常的"，那说明：
- 某些按键虽然 LED 显示不对，但功能正常
- 可能是因为巧合（例如发送 'B'，被当作后退处理）

如果功能正常就行，可以不管 LED 显示，直接测试小车动作。

---

**现在请选择一个方案，或者直接告诉我：**
1. 你想使用哪个物理按键控制前进？
2. 你想使用哪个物理按键控制后退？
3. 你想使用哪个物理按键控制左转？
4. 你想使用哪个物理按键控制右转？

我帮你生成正确的映射！🎯
