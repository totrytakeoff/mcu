# LED ASCII 调试参考

## 问题：收到指令全亮（1111）

如果 LED 全亮，说明收到的字符不在已知指令列表中。现在 LED 会显示**未知字符的 ASCII 码低 4 位**，帮助你识别实际收到的是什么。

---

## ASCII 码参考表（低 4 位）

### 常见字符的 ASCII 码与 LED 显示

| 字符 | ASCII (十进制) | ASCII (十六进制) | 低 4 位 | LED 显示 (PB14-13-12-5) |
|------|---------------|-----------------|---------|-------------------------|
| **'0'** | 48 | 0x30 | 0 (0000) | ○ ○ ○ ○ |
| **'1'** | 49 | 0x31 | 1 (0001) | ○ ○ ○ ● |
| **'2'** | 50 | 0x32 | 2 (0010) | ○ ○ ● ○ |
| **'3'** | 51 | 0x33 | 3 (0011) | ○ ○ ● ● |
| **'4'** | 52 | 0x34 | 4 (0100) | ○ ● ○ ○ |
| **'5'** | 53 | 0x35 | 5 (0101) | ○ ● ○ ● |
| **'6'** | 54 | 0x36 | 6 (0110) | ○ ● ● ○ |
| **'7'** | 55 | 0x37 | 7 (0111) | ○ ● ● ● |
| **'8'** | 56 | 0x38 | 8 (1000) | ● ○ ○ ○ |
| **'9'** | 57 | 0x39 | 9 (1001) | ● ○ ○ ● |
| | | | | |
| **'A'** | 65 | 0x41 | 1 (0001) | ○ ○ ○ ● |
| **'B'** | 66 | 0x42 | 2 (0010) | ○ ○ ● ○ |
| **'C'** | 67 | 0x43 | 3 (0011) | ○ ○ ● ● |
| **'D'** | 68 | 0x44 | 4 (0100) | ○ ● ○ ○ |
| **'E'** | 69 | 0x45 | 5 (0101) | ○ ● ○ ● |
| **'F'** | 70 | 0x46 | **6** (0110) | ○ ● ● ○ |
| **'G'** | 71 | 0x47 | 7 (0111) | ○ ● ● ● |
| | | | | |
| **'a'** | 97 | 0x61 | 1 (0001) | ○ ○ ○ ● |
| **'b'** | 98 | 0x62 | 2 (0010) | ○ ○ ● ○ |
| **'c'** | 99 | 0x63 | 3 (0011) | ○ ○ ● ● |
| **'d'** | 100 | 0x64 | 4 (0100) | ○ ● ○ ○ |
| **'e'** | 101 | 0x65 | 5 (0101) | ○ ● ○ ● |
| **'f'** | 102 | 0x66 | 6 (0110) | ○ ● ● ○ |
| **'g'** | 103 | 0x67 | 7 (0111) | ○ ● ● ● |
| | | | | |
| **空格** | 32 | 0x20 | 0 (0000) | ○ ○ ○ ○ |
| **'\r'** | 13 | 0x0D | 13 (1101) | ● ● ○ ● |
| **'\n'** | 10 | 0x0A | 10 (1010) | ● ○ ● ○ |

---

## 已知指令的预期 LED 显示

| 指令 | ASCII | LED 编码 | LED 显示 |
|------|-------|----------|----------|
| **'F'** | 70 | 1 | ○ ○ ○ ● |
| **'B'** | 66 | 2 | ○ ○ ● ○ |
| **'L'** | 76 | 3 | ○ ○ ● ● |
| **'R'** | 82 | 4 | ○ ● ○ ○ |
| **'U'** | 85 | 5 | ○ ● ○ ● |
| **'D'** | 68 | 6 | ○ ● ● ○ |
| **'W'** | 87 | 7 | ○ ● ● ● |
| **'X'** | 88 | 8 | ● ○ ○ ○ |
| **'Y'** | 89 | 9 | ● ○ ○ ● |
| **'Z'** | 90 | 10 | ● ○ ● ○ |

---

## 调试步骤

### 1. 观察 LED 显示

按下遥控器按键后，记录 LED 显示：

```
示例 1：○ ● ● ○ (6)
可能是：
  - 'F' (大写F) → 正常，应该显示 1
  - 'f' (小写f) → ASCII 0x66，低4位 = 6
  - '6' (数字6) → ASCII 0x36，低4位 = 6
  
结论：可能遥控器发送的是小写 'f' 或数字 '6'
```

### 2. 查表对照

根据 LED 显示查上表，确定实际接收到的字符：

| LED 显示 | 低 4 位 | 可能的字符 |
|----------|---------|-----------|
| ○○○○ (0) | 0 | '0', '@', 'P', 'p', 空格 |
| ○○○● (1) | 1 | '1', 'A', 'Q', 'a', 'q' |
| ○○●○ (2) | 2 | '2', 'B', 'R', 'b', 'r' |
| ○○●● (3) | 3 | '3', 'C', 'S', 'c', 's' |
| ○●○○ (4) | 4 | '4', 'D', 'T', 'd', 't' |
| ○●○● (5) | 5 | '5', 'E', 'U', 'e', 'u' |
| ○●●○ (6) | 6 | '6', 'F', 'V', 'f', 'v' |
| ○●●● (7) | 7 | '7', 'G', 'W', 'g', 'w' |
| ●○○○ (8) | 8 | '8', 'H', 'X', 'h', 'x' |
| ●○○● (9) | 9 | '9', 'I', 'Y', 'i', 'y' |
| ●○●○ (10) | 10 | ':', 'J', 'Z', 'j', 'z', '\n' |
| ●○●● (11) | 11 | ';', 'K', '[', 'k', '{' |
| ●●○○ (12) | 12 | '<', 'L', '\\', 'l', '\|' |
| ●●○● (13) | 13 | '=', 'M', ']', 'm', '}', '\r' |
| ●●●○ (14) | 14 | '>', 'N', '^', 'n', '~' |
| ●●●● (15) | 15 | '?', 'O', '_', 'o' |

### 3. 常见问题判断

#### 问题 A：LED 显示 ○ ● ● ○ (6)
**可能原因**：
- 遥控器发送小写 'f' 而不是大写 'F'
- 或者发送的是数字 '6'

**解决方法**：
```cpp
// 在 remote_control.cpp 中添加小写字母支持
case 'f':  // 小写也支持
case 'F': ledCode = 1; break;

case 'b':
case 'B': ledCode = 2; break;
// ... 其他字母同理
```

#### 问题 B：LED 显示 ● ● ○ ● (13)
**可能原因**：
- 收到回车符 '\r' (ASCII 13)
- 遥控器在指令后添加了换行符

**解决方法**：
```cpp
// 忽略控制字符
if (command == '\r' || command == '\n') {
    return;  // 直接返回，不处理
}
```

#### 问题 C：LED 显示 ○ ○ ○ ○ (0)
**可能原因**：
- 收到空格或数字 '0'
- 或者接收缓冲区未初始化

**解决方法**：
- 检查 UART 接收是否正常
- 确认遥控器是否真的发送了数据

---

## 快速诊断表

| 现象 | 可能原因 | 解决方法 |
|------|---------|---------|
| LED 全亮 (1111) | 收到完全未知的字符 | 添加 ASCII 调试，查看实际字符 |
| LED 显示 6 | 小写 'f' 或数字 '6' | 添加小写字母支持 |
| LED 显示 13 | 回车符 '\r' | 过滤控制字符 |
| LED 显示 10 | 换行符 '\n' | 过滤控制字符 |
| LED 闪烁 0-15 | 持续接收垃圾数据 | 检查 E49 配置和波特率 |

---

## 修改建议

### 1. 添加小写字母支持

```cpp
// 在 handleCommand 中
switch (command) {
    case 'f': case 'F': ledCode = 1; break;
    case 'b': case 'B': ledCode = 2; break;
    case 'l': case 'L': ledCode = 3; break;
    case 'r': case 'R': ledCode = 4; break;
    case 'u': case 'U': ledCode = 5; break;
    case 'd': case 'D': ledCode = 6; break;
    case 'w': case 'W': ledCode = 7; break;
    case 'x': case 'X': ledCode = 8; break;
    case 'y': case 'Y': ledCode = 9; break;
    case 'z': case 'Z': ledCode = 10; break;
    default: ledCode = command & 0x0F; break;
}
```

### 2. 过滤控制字符

```cpp
void RemoteControl::handleCommand(char command) {
    // 过滤控制字符
    if (command < 32 || command > 126) {
        // 显示但不执行
        setDebugLED(command & 0x0F);
        return;
    }
    
    // ... 正常处理
}
```

---

## 测试步骤

1. **烧录固件**：`pio run -t upload`

2. **按下遥控器按键**

3. **观察 LED 显示**：
   - 如果是 1-10 → 指令正确接收
   - 如果是其他值 → 查表对照，找出实际字符

4. **根据结果调整**：
   - 如果是小写字母 → 添加小写支持
   - 如果是数字 → 检查遥控器配置
   - 如果是控制字符 → 添加过滤

---

## 典型案例

### 案例 1：遥控器发送小写字母
```
按下前进键：
LED 显示：○ ● ● ○ (6)
查表：可能是 'f'
解决：添加小写 'f' 支持
```

### 案例 2：遥控器发送数字
```
按下前进键：
LED 显示：○ ○ ○ ● (1)
查表：可能是 '1'
解决：在指令映射中添加 '1' → 前进
```

### 案例 3：带换行符
```
按下前进键：
LED 先显示 ○ ○ ○ ● (F 正确)
然后显示 ● ○ ● ○ (10，换行符)
解决：过滤掉换行符
```

---

**现在烧录固件，观察 LED 显示，然后告诉我显示的是什么，我帮你分析！** 🔍
